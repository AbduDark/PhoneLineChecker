<Window x:Class="PhoneLinesApp.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:PhoneLinesApp.UI.Converters"
        Title="Phone Lines Management"
        Height="500"
        Width="800">
    <DockPanel Margin="10">

        <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="0,0,0,10">
            <ComboBox Width="120"
                      ItemsSource="{StaticResource StatusOptions}"
                      SelectedItem="{Binding SelectedStatus}" />

            <TextBox Width="200" Margin="10,0,0,0"
                     Text="{Binding SearchTerm, UpdateSourceTrigger=PropertyChanged}" />

            <Button Content="بحث" Margin="5,0,0,0"
                    Command="{Binding LoadCommand}" />

            <Button Content="إضافة" Margin="20,0,0,0"
                    Command="{Binding AddCommand}" />

            <Button Content="تعديل" Margin="5,0,0,0"
                    Command="{Binding EditCommand}"
                    CommandParameter="{Binding SelectedItem, ElementName=dg}" />

            <Button Content="حذف" Margin="5,0,0,0"
                    Command="{Binding DeleteCommand}"
                    CommandParameter="{Binding SelectedItem, ElementName=dg}" />
        </StackPanel>

        <DataGrid x:Name="dg"
                  ItemsSource="{Binding Lines}"
                  AutoGenerateColumns="False"
                  CanUserSortColumns="True"
                  IsReadOnly="True"
                  Margin="0,5,0,0">
            <DataGrid.Resources>
                <Style TargetType="DataGridRow">
                    <Style.Triggers>
                        <DataTrigger Value="True">
                            <DataTrigger.Binding>
                                <MultiBinding Converter="{StaticResource ActivationWarningConverter}"
                                              ConverterParameter="7">
                                    <Binding Path="LastActivationDate" />
                                    <Binding Path="IsActive" />
                                </MultiBinding>
                            </DataTrigger.Binding>
                            <Setter Property="Background" Value="LightCoral" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.Resources>

            <DataGrid.Columns>
                <DataGridTextColumn Header="رقم الخط"
                                    Binding="{Binding PhoneNumber}"
                                    Width="*" />
                <DataGridTextColumn Header="النوع"
                                    Binding="{Binding LineType}"
                                    Width="*" />
                <DataGridTextColumn Header="آخر تفعيل"
                                    Binding="{Binding LastActivationDate, StringFormat=\{0:yyyy-MM-dd\}}"
                                    Width="*" />
                <DataGridCheckBoxColumn Header="مفعّل؟"
                                        Binding="{Binding IsActive}"
                                        Width="Auto" />
                <DataGridTextColumn Header="ملاحظات"
                                    Binding="{Binding Notes}"
                                    Width="2*" />
            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</Window>
